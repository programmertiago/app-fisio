{% extends "base.html" %}

{% block title %}Detalhes de {{ paciente.nome }}{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{{ url_for('painel_diario') }}" class="btn btn-outline-secondary btn-sm">&larr; Voltar ao Painel</a>
    </div>

    <div class="card patient-header mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h1 class="patient-header__name">{{ paciente.nome }} ({{ paciente.idade }} anos)</h1>
                    <div class="patient-header__details text-muted">
                        <span><strong>Data de Nascimento:</strong> {{ paciente.data_nascimento }}</span> | 
                        <span><strong>Leito:</strong> {{ paciente.leito }}</span> | 
                        <span><strong>Unidade:</strong> {{ paciente.unidade }}</span> | 
                        <span><strong>Status:</strong> {{ paciente.status }}</span>
                    </div>
                </div>
                <a href="{{ url_for('editar_paciente', paciente_id=paciente.id) }}" class="btn btn-secondary">Editar Dados</a>
            </div>
            <hr>
            <p class="mb-0"><strong>Diagnóstico:</strong> {{ paciente.diagnostico }}</p>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header fw-bold">
            Gestão do Paciente
        </div>
        <div class="card-body">
            <form action="{{ url_for('mudar_unidade', paciente_id=paciente.id) }}" method="POST" class="row g-3 align-items-center mb-3 pb-3 border-bottom">
                <div class="col-auto">
                    <label for="unidade" class="col-form-label">Transferir para:</label>
                </div>
                <div class="col-md-4">
                    <select class="form-select" id="unidade" name="unidade" required>
                        <option value="1ª Enfermaria">1ª Enfermaria</option>
                        <option value="2ª Enfermaria">2ª Enfermaria</option>
                        <option value="3ª Enfermaria">3ª Enfermaria</option>
                        <option value="UTI">UTI</option>
                    </select>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">Mudar Unidade</button>
                </div>
            </form>
            <form action="{{ url_for('inativar_paciente', paciente_id=paciente.id) }}" method="POST" class="row g-3 align-items-center mt-3">
                <div class="col-auto">
                     <label for="motivo" class="col-form-label">Inativar por (Alta, óbito, etc):</label>
                </div>
                <div class="col-md-4">
                    <input type="text" class="form-control" name="motivo" id="motivo" placeholder="Ex: Alta hospitalar" required>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-danger">Inativar Paciente</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header fw-bold">
            Adicionar Nova Evolução/Conduta
        </div>
        <div class="card-body">
            <form action="{{ url_for('adicionar_evolucao', paciente_id=paciente.id) }}" method="POST">
                <div class="mb-3">
                    <label for="evolucao" class="form-label">Avaliação, Condutas e Plano Terapêutico:</label>
                    <textarea class="form-control" id="evolucao" name="evolucao" rows="5" required></textarea>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="turno_atendimento" class="form-label">Atendimento referente ao turno:</label>
                        <select class="form-select" id="turno_atendimento" name="turno_atendimento" required>
                            <option value="manha">Manhã</option>
                            <option value="tarde">Tarde</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">Salvar Evolução</button>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header fw-bold">
            Histórico de Evoluções
        </div>
        <div class="list-group list-group-flush">
            {% for evolucao in evolucoes %}
            <div class="list-group-item evolution-item">
                <div class="evolution-item__meta text-muted">
                    <span><strong>Data:</strong> {{ evolucao.data.strftime('%d/%m/%Y às %H:%M') }}</span> | 
                    <span><strong>Fisio:</strong> {{ evolucao.fisio }}</span>
                </div>
                <div class="evolution-item__text mt-2">
                    {{ evolucao.texto | nl2br }}
                </div>
            </div>
            {% else %}
            <div class="list-group-item">
                <p class="text-muted mb-0">Nenhuma evolução registrada para este paciente.</p>
            </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}